# SPDX-License-Identifier: Apache-2.0
# Copyright Contributors to the ASWF Sample Project
#
# A simple multi-platform Azure Pipelines definition to build, run test suite
# and upload results to test dashboard.

strategy:
  matrix:
    linux:
      imageName: 'ubuntu-latest'
    mac:
      imageName: 'macOS-latest'
    windows:
      imageName: 'windows-latest'

trigger:
- master

pool:
  vmImage: $(imageName)

steps:
- script: |
    mkdir build
    cd build
    cmake ..
    cmake --build .
  displayName: Build
- script: |
    ctest --verbose -S ../CTestScript.cmake
  env:
    CTEST_SOURCE_DIRECTORY: $(Build.SourcesDirectory)
    CTEST_BUILD_NAME: $(Build.BuildNumber)
    CTEST_SITE: $(Agent.MachineName)
  workingDirectory: build
  displayName: Test
